<!doctype html><html lang=en><head><title>Rust 2020 🦀 :: null pointer</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Every year I think of writing a &amp;ldquo;Rust 20xx&amp;rdquo;1 post, and I never do, but this year I&amp;rsquo;ve decided to power through the procrastination, I&amp;rsquo;m also on a 5 hour flight with no Wi-Fi, so this will at least provide me with some form of entertainment!
Since I&amp;rsquo;m blessed enough to work full-time using Rust I end up having two separate sets of goals for Rust, one from the point of view of Standard Cognition (Sc) as a company that is committed to Rust, and another as someone who likes to work on projects in Rust in his free time."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/rust-2020/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/images/favicon.png><meta name=twitter:card content="summary"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Rust 2020 🦀"><meta property="og:description" content="Every year I think of writing a &amp;ldquo;Rust 20xx&amp;rdquo;1 post, and I never do, but this year I&amp;rsquo;ve decided to power through the procrastination, I&amp;rsquo;m also on a 5 hour flight with no Wi-Fi, so this will at least provide me with some form of entertainment!
Since I&amp;rsquo;m blessed enough to work full-time using Rust I end up having two separate sets of goals for Rust, one from the point of view of Standard Cognition (Sc) as a company that is committed to Rust, and another as someone who likes to work on projects in Rust in his free time."><meta property="og:url" content="/posts/rust-2020/"><meta property="og:site_name" content="null pointer"><meta property="og:image" content="/images/favicon.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="essay"><meta property="article:published_time" content="2019-11-24 20:38:15 +0000 UTC"></head><body class=green><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>null pointer</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/categories>Categories</a></li><li><a href=/tags>Tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/categories>Categories</a></li><li><a href=/tags>Tags</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/rust-2020/>Rust 2020 🦀</a></h1><div class=post-meta><span class=post-date>2019-11-24</span></div><span class=post-tags>#<a href=/tags/rust/>rust</a>&nbsp;
#<a href=/tags/2020/>2020</a>&nbsp;
#<a href=/tags/standard/>standard</a>&nbsp;
#<a href=/tags/cognition/>cognition</a>&nbsp;</span><div class=post-content><div><p>Every year I think of writing a &ldquo;Rust 20xx&rdquo;<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> post, and I never do, but this
year I&rsquo;ve decided to power through the procrastination, I&rsquo;m also on a 5 hour
flight with no Wi-Fi, so this will at least provide me with some form of
entertainment!</p><p>Since I&rsquo;m blessed enough to work full-time using Rust I end up having two
separate sets of goals for Rust, one from the point of view of <a href=https://standard.ai>Standard
Cognition</a> (Sc) as a company that is committed to Rust, and another as
someone who likes to work on projects in Rust in his free time. I&rsquo;ll separate
both, and try to not jumble my wishes for Standard and my personal ones.</p><h2 id=standard-cognition--rust-in-2020>Standard Cognition & Rust in 2020<a href=#standard-cognition--rust-in-2020 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>One of our main annoyances at Sc is the fact that we are still on the nightly
compiler, mostly due to a number of features that we couldn&rsquo;t build our
product without, but that still haven&rsquo;t seen their way through to
stabilization. Namely, these are:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Bash data-lang=Bash><span style=display:flex><span>rg --no-filename <span style=color:#e6db74>&#39;^#!\[feature(.+)]&#39;</span> | sort -u
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Rust data-lang=Rust><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/52662
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(associated_type_bounds)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/62290
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(async_closure)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/61356
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(bound_cloned)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// We use this for printing the type name in generic errors,
</span></span></span><span style=display:flex><span><span style=color:#75715e>// an alternative has been recently stabilized, IIRC
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(core_intrinsics)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/43244
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(drain_filter)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/44732
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(external_doc)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/29625
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(fn_traits)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/56167
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(hash_raw_entry)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/53485
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(is_sorted)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/35121
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(never_type)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/13231
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(optin_builtin_traits)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/60258
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(option_flattening)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/53268
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(result_map_or_else)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/31844
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(specialization)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/42168
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(step_trait)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/41517
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(trait_alias)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/42327
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(try_trait)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/rust-lang/rust/issues/29625
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#![feature(unboxed_closures)]</span>
</span></span></code></pre></div><p>I&rsquo;m fairly sure a couple of these have only recently been stabilized, but we
only bump the compiler once in a blue moon since it&rsquo;s usually a bit of a
chore. Most notably, the <code>never_type</code> was just stabilized!</p><p>There are some other features that we don&rsquo;t use, but only because the path for
them to be stabilized is so unclear and we didn&rsquo;t want to further commit to
using unstable features. The big ones here, where stabilization would be a
revolution in our codebase are const generics and GATs. My understanding is
that for the former we would ideally achieve lazy normalization inside the
compiler, and that there&rsquo;s still quite a bit of work ahead of us for that. For
GATs I&rsquo;m not quite sure which yaks will need to be shaven.</p><p>Another thing we&rsquo;d like to see at Sc is a number of improvements to Cargo,
some things that come to mind are:</p><ol><li>Constraining <code>build.rs</code><ul><li>We&rsquo;d like for it to <em>not</em> have network access, and possibly only
limited filesystem access. Right now the build script has unlimited
power, which is really no good.</li></ul></li><li>Better dependency handling<ul><li>There are a number of annoyances in Cargo relating to
dependencies. The primary one being that if a crate exposes both a
binary and a library (c.f. <code>clap</code> + <code>bindgen</code>, etc) but you only use
the library portion you must still download and build all the
binary-only dependencies. Another issue is that
<code>build-dependencies</code> share the same resolution graph with
<code>dev-dependencies</code> and <code>dependencies</code> which causes issues in
settings where the target doesn&rsquo;t support a build dependency even
though only the host needs it (for building.)</li></ul></li><li>Better integration with other build systems<ul><li>Cargo is pretty great as a standalone build tool for Rust, but it&rsquo;s
pretty bad at integrating with anything else. At Sc we use Nix
everywhere, and the intgration with Rust has been painful, though
there are promising projects like crate2nix.</li></ul></li></ol><p>The last big thing we&rsquo;re excited about is async/await, here are some of the
things we&rsquo;re still missing from it:</p><ol><li>Streams<ul><li>Ideally we&rsquo;d model a lot of our workloads with streams, so we&rsquo;d love to
see them stabilized and well-supported.</li></ul></li><li>Stable ecosystem<ul><li>It feels like Tokio has been around since forever without reaching 1.0
status, we&rsquo;d like to see more proactiveness around stabilization;
async-std has been a positive force in this space.</li><li>On a separate note, the Rust ecosystem as a whole has started abusing
semver in weird ways, such as versioning crates to the liking of
<code>0.1.0alpha7</code> as opposed to just bumping the revision. Let&rsquo;s bump
revisions in the 0.x range quickly and aim for stabilization; having to
tag a <code>2.0</code> some day isn&rsquo;t the end of the world.</li></ul></li><li>Clear performance metrics<ul><li>As the ecosystem becomes increasingly diverse it&rsquo;ll become necessary
for there to be a &ldquo;unified measuring stick&rdquo; so that performance can be
reasonably compared.</li></ul></li></ol><p>As a final note on Sc, I think it&rsquo;s easy for us who are heavily invested and
deeply embedded into Rust to miss the forest for the trees and think that the
lack of this or that feature, or that the existence of one or another wart in
the ecosystem is a much bigger deal than it really is. Asking my coworkers who
learned Rust on the job and transitioned from C++ and Java the feedback is
overwhelmingly positive, even about the &lsquo;wartiest&rsquo; parts of the ecosystem. I
think Rust has achieved a lot more than we give ourselves credit for.</p><h2 id=bernardo--rust-in-2020>Bernardo & Rust in 2020<a href=#bernardo--rust-in-2020 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>While most of my desires for Rust align with Sc&rsquo;s there are a few things that
are strictly personal wishes, namely:</p><ol><li>Rust 2021<ul><li>I think we should have an edition in 2021, and if the 2018 edition
taught us anything it&rsquo;s that we should take more time in the edition
process, I think two years instead of one will be a huge win.</li></ul></li><li>Better embedded support<ul><li>It&rsquo;s a bit silly that we still need to use cargo-xbuild (fka. xargo)
it&rsquo;s about time Cargo has first-class support for these use-cases.</li></ul></li><li>Stable ABI</li><li>Lazy normalization</li><li>Simple ways to unify CLI options and config<ul><li>Right now it&rsquo;s simple to create a CLI app with rust using
structopt, and it&rsquo;s also trivial to define and source a TOML config
file, but combining both is not nearly as easy as it could be.</li></ul></li><li>Better IDE support<ul><li>RLS is alright, but still has ways to go, and the 2.0 efforts are
promising, but we have to see these things through.</li><li>Parsing Rust is not easy, the vim syntax highlighter struggles with
large Rust files.</li></ul></li><li>Further work on unsafe guidelines.</li></ol><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>If you&rsquo;re reading this after 2099, sorry for the inconsistency.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/c-arrays-are-not-pointers/><span class=button__icon>←</span>
<span class=button__text>C Arrays Are Not Pointers</span></a></span>
<span class="button next"><a href=/posts/the-lost-ark/><span class=button__text>The Lost Ark</span>
<span class=button__icon>→</span></a></span></div></div><script src=https://utteranc.es/client.js repo=lovesegfault/blog issue-term=title theme=github-dark crossorigin=anonymous async></script></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>Copyright &copy; 2021 - Bernardo Meurer</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script>
<script>window.WebFontConfig={custom:{families:["KaTeX_AMS","KaTeX_Caligraphic:n4,n7","KaTeX_Fraktur:n4,n7","KaTeX_Main:n4,n7,i4,i7","KaTeX_Math:i4,i7","KaTeX_Script","KaTeX_SansSerif:n4,n7,i4","KaTeX_Size1","KaTeX_Size2","KaTeX_Size3","KaTeX_Size4","KaTeX_Typewriter"]}}</script><script defer src=https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin=anonymous></script><link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css integrity=sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc crossorigin=anonymous as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css integrity=sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc crossorigin=anonymous></noscript><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js integrity=sha384-YNHdsYkH6gMx9y3mRkmcJ2mFUjTd0qNQQvY9VYZgQd7DcN7env35GzlmFaZ23JGp crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload=renderMathInElement(document.body)></script></div></body></html>